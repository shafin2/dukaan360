<% content_for :page_title, "Sales History" %>

<div class="p-4 max-w-7xl mx-auto space-y-4">
  <!-- Header Section -->
  <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 overflow-hidden">
    <div class="bg-gradient-to-r from-green-600 to-emerald-600 px-6 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-xl font-bold text-white">Sales History</h1>
          <p class="text-green-100">Track all your sales transactions</p>
        </div>
        <div>
          <%= link_to new_sale_path,
              class: "inline-flex items-center px-4 py-2 bg-white text-green-600 text-sm font-semibold rounded-lg hover:bg-green-50 transition-colors no-underline" do %>
            <i data-feather="plus" class="w-4 h-4 mr-2"></i>
            Record New Sale
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Sales Stats -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-4">
      <div class="flex items-center">
        <div class="w-10 h-10 bg-gradient-to-r from-green-100 to-green-200 rounded-lg flex items-center justify-center mr-3">
          <i data-feather="trending-up" class="w-5 h-5 text-green-600"></i>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-600">Today's Sales</p>
          <p class="text-xl font-bold text-green-600">PKR <%= number_with_delimiter(@today_sales) %></p>
        </div>
      </div>
    </div>

    <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-4">
      <div class="flex items-center">
        <div class="w-10 h-10 bg-gradient-to-r from-blue-100 to-blue-200 rounded-lg flex items-center justify-center mr-3">
          <i data-feather="dollar-sign" class="w-5 h-5 text-blue-600"></i>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-600">Total Sales</p>
          <p class="text-xl font-bold text-blue-600">PKR <%= number_with_delimiter(@total_sales) %></p>
        </div>
      </div>
    </div>

    <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 p-4">
      <div class="flex items-center">
        <div class="w-10 h-10 bg-gradient-to-r from-purple-100 to-purple-200 rounded-lg flex items-center justify-center mr-3">
          <i data-feather="package" class="w-5 h-5 text-purple-600"></i>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-600">Total Transactions</p>
          <p class="text-xl font-bold text-purple-600"><%= @sales.total_entries %></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Sales Table -->
  <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-lg border border-white/20 overflow-hidden">
    <div class="bg-gradient-to-r from-gray-600 to-gray-700 px-6 py-4">
      <h3 class="text-lg font-semibold text-white">Recent Sales</h3>
    </div>

    <div class="overflow-x-auto">
      <% if @sales.any? %>
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Date & Time
              </th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Product
              </th>
              <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                Quantity
              </th>
              <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                Unit Price
              </th>
              <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                Total Amount
              </th>
              <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                Sale Type
              </th>
              <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                Sold By
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @sales.each do |sale| %>
              <tr class="hover:bg-gray-50 transition-colors">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900">
                    <%= sale.created_at.strftime("%b %d, %Y") %>
                  </div>
                  <div class="text-sm text-gray-500">
                    <%= sale.created_at.strftime("%I:%M %p") %>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <div class="flex items-center">
                    <div class="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center mr-3 overflow-hidden flex-shrink-0">
                      <% if sale.product.image_url.present? %>
                        <img src="<%= sale.product.image_url %>" alt="<%= sale.product.name %>" class="w-full h-full object-cover rounded-lg">
                      <% else %>
                        <i data-feather="package" class="w-5 h-5 text-gray-500"></i>
                      <% end %>
                    </div>
                    <div>
                      <div class="text-sm font-medium text-gray-900">
                        <%= sale.product.name %>
                      </div>
                      <% if sale.product.category.present? %>
                        <div class="text-xs text-gray-500">
                          <%= sale.product.category %>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span class="text-sm font-semibold text-gray-900">
                    <%= sale.quantity %>
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span class="text-sm text-gray-900">
                    PKR <%= number_with_delimiter(sale.unit_price) %>
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <span class="text-sm font-bold text-green-600">
                    PKR <%= number_with_delimiter(sale.total_amount) %>
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <% if sale.bill.present? %>
                    <div class="flex flex-col items-center">
                      <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full <%= sale.bill.cash_bill? ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800' %>">
                        <i data-feather="<%= sale.bill.cash_bill? ? 'dollar-sign' : 'credit-card' %>" class="w-3 h-3 mr-1"></i>
                        <%= sale.bill.cash_bill? ? 'Cash' : 'Credit' %>
                      </span>
                      <div class="text-xs text-gray-500 mt-1">
                        Bill #<%= sale.bill.bill_number %>
                      </div>
                    </div>
                  <% else %>
                    <span class="inline-flex items-center px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">
                      <i data-feather="shopping-cart" class="w-3 h-3 mr-1"></i>
                      Direct Sale
                    </span>
                  <% end %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                  <div class="flex items-center justify-center">
                    <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-2">
                      <span class="text-xs font-medium text-blue-600">
                        <%= sale.user.name.first.upcase %>
                      </span>
                    </div>
                    <span class="text-sm text-gray-900">
                      <%= sale.user.name %>
                    </span>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>

        <!-- Pagination -->
        <% if @sales.total_pages > 1 %>
          <div class="px-6 py-4 border-t border-gray-200 bg-gray-50">
            <div class="flex items-center justify-between">
              <div class="text-sm text-gray-700">
                Showing <%= @sales.offset + 1 %>-<%= [@sales.offset + @sales.per_page, @sales.total_entries].min %> of <%= @sales.total_entries %> sales
              </div>
              
              <div class="flex items-center space-x-2">
                <%= will_paginate @sales, 
                    previous_label: '←',
                    next_label: '→',
                    class: 'pagination flex items-center space-x-1',
                    inner_window: 2,
                    outer_window: 1,
                    page_links: true,
                    container: false %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="text-center py-12">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <i data-feather="shopping-cart" class="w-8 h-8 text-gray-400"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">No sales recorded yet</h3>
          <p class="text-gray-500 mb-6">Start recording your first sale to see transaction history here</p>
          <%= link_to new_sale_path,
              class: "inline-flex items-center px-4 py-2 bg-green-600 text-white text-sm font-medium rounded-lg hover:bg-green-700 transition-colors no-underline" do %>
            <i data-feather="plus" class="w-4 h-4 mr-2"></i>
            Record First Sale
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  feather.replace();
</script>

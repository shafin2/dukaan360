<%= form_with model: product, local: true, class: "max-w-3xl mx-auto" do |f| %>
  <!-- Error Messages -->
  <% if product.errors.any? %>
    <div class="mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
      <h3 class="text-red-800 font-semibold mb-2">Please fix the following errors:</h3>
      <ul class="list-disc list-inside text-sm text-red-700">
        <% product.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="bg-white border border-gray-200 rounded-lg shadow-sm p-6 space-y-6">
    
    <!-- Product Name -->
    <div>
      <%= f.label :name, "Product Name *", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.text_field :name, 
          class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
          placeholder: "e.g., KitKat Chocolate Box" %>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Category -->
      <div>
        <%= f.label :category, "Category", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_field :category, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "e.g., Chocolates", 
            list: "categories" %>
        <datalist id="categories">
          <% if current_user&.business&.products %>
            <% current_user.business.products.distinct.pluck(:category).compact.each do |category| %>
              <option value="<%= category %>"></option>
            <% end %>
          <% end %>
          <option value="Chocolates"></option>
          <option value="Biscuits"></option>
          <option value="Snacks"></option>
          <option value="Chips"></option>
          <option value="Candies"></option>
        </datalist>
      </div>

      <!-- SKU -->
      <div>
        <%= f.label :sku, "SKU", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_field :sku, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "e.g., KTK-001" %>
      </div>
    </div>

    <!-- Description -->
    <div>
      <%= f.label :description, "Description", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.text_area :description, 
          rows: 3, 
          class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
          placeholder: "Brief description of the product" %>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- Buying Price (Owner Only) -->
      <% if current_user.business_owner? %>
      <div>
        <%= f.label :buying_price, "Buying Price (₨) *", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.number_field :buying_price, 
            step: 0.01, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "0.00" %>
      </div>
      <% end %>

      <!-- Selling Price -->
      <div>
        <%= f.label :selling_price, "Selling Price (₨) *", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.number_field :selling_price, 
            step: 0.01, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "0.00" %>
      </div>

      <!-- Unit -->
      <div>
        <%= f.label :unit, "Unit", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_field :unit, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "e.g., piece, box, pack" %>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Expiry Date -->
      <div>
        <%= f.label :expiry_date, "Expiry Date (Optional)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.date_field :expiry_date, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" %>
      </div>

      <!-- Image URL -->
      <div>
        <%= f.label :image_url, "Image URL (Optional)", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= f.text_field :image_url, 
            class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
            placeholder: "https://example.com/image.jpg" %>
      </div>
    </div>

    <!-- Stock Management (Optional advanced fields) -->
    <details class="border-t border-gray-200 pt-6">
      <summary class="cursor-pointer text-sm font-medium text-gray-700 mb-4">Advanced Stock Settings (Optional)</summary>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
        <div>
          <%= f.label :min_stock_level, "Min Stock Level", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :min_stock_level, 
              class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
              placeholder: "10" %>
        </div>
        
        <div>
          <%= f.label :max_stock_level, "Max Stock Level", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :max_stock_level, 
              class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
              placeholder: "100" %>
        </div>
        
        <div>
          <%= f.label :reorder_point, "Reorder Point", class: "block text-sm font-medium text-gray-700 mb-2" %>
          <%= f.number_field :reorder_point, 
              class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500", 
              placeholder: "20" %>
        </div>
      </div>
    </details>

    <!-- Action Buttons -->
    <div class="flex items-center justify-end gap-3 pt-6 border-t border-gray-200">
      <%= link_to "Cancel", products_path, class: "px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50" %>
      <%= f.submit product.persisted? ? "Update Product" : "Create Product", 
          class: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700" %>
    </div>
  </div>
<% end %>
